<project name="app-tenant-mgmt" default="clone-tenant" basedir=".">
  <description>Manage Application layer folders and files containing per-tenant configurations</description>
  
  <!-- Location of the 'tenants' directory for this CollectionSpace source code layer. -->
  <property name="src.dir" value="${basedir}" />
  <property name="resources.dir" value="${src.dir}/tomcat-main/src/main/resources"/>
  <property name="tenants.dir" value="${resources.dir}/tenants"/>
  
  <!-- Imports a set of utility routines for managing tenant folders
       from a separate Ant buildfile.
       See http://wiki.apache.org/ant/NewAntFeaturesInDetail/Import -->
  <import file="./tenant-utils-build.xml"/>
  
  <!-- This target inherits from an existing target in the imported
       utility routines buildfile, and adds its own behavior specific to this
       CollectionSpace source code layer. -->
  <target name="clone-from-template" depends="tenant-utils.clone-from-template">
    <copy file="${resources.dir}/${template.tenant.shortname}-tenant.xml"
       tofile="${resources.dir}/${tenant.shortname}-tenant.xml"/>
  </target>
  
  <!-- This target inherits from an (essentially empty) target in the imported
       utility routines buildfile, and adds its own behavior specific to this
       CollectionSpace source code layer. -->
  <target name="update-text-in-cloned-tenant" depends="tenant-utils.update-text-in-cloned-tenant">
    <!-- TODO: Isolate text replacements below, each in their own focused targets. -->
    <!-- Update text in the tenant config file. -->
    <replace file="${resources.dir}/${tenant.shortname}-tenant.xml" token="${template.tenant.shortname}"
      value="${tenant.shortname}">
    </replace>
    <!-- Update text in the tenant settings file. -->
    <replaceregexp
        match="&lt;tenant&gt;(.*)&lt;/tenant&gt;"
        replace="&lt;tenant&gt;${tenant.id}&lt;/tenant&gt;">
    <fileset dir="${tenants.dir}/${tenant.shortname}" includes="settings.xml" />
   </replaceregexp>
  </target>
    
</project>